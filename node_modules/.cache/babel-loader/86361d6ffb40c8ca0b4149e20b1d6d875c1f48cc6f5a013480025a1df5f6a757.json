{"ast":null,"code":"import React,{useState,useEffect,useRef}from\"react\";import{auth,db}from\"../firebase/config\";import{collection,query,where,orderBy,addDoc,serverTimestamp,onSnapshot}from\"firebase/firestore\";import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const Chat=_ref=>{let{selectedFriend}=_ref;const[messages,setMessages]=useState([]);const[input,setInput]=useState(\"\");const messagesEndRef=useRef(null);// Fetch messages in real-time\nuseEffect(()=>{var _auth$currentUser,_auth$currentUser2;if(!selectedFriend){setMessages([]);return;}const q=query(collection(db,\"messages\"),where(\"from\",\"in\",[(_auth$currentUser=auth.currentUser)===null||_auth$currentUser===void 0?void 0:_auth$currentUser.uid,selectedFriend]),where(\"to\",\"in\",[(_auth$currentUser2=auth.currentUser)===null||_auth$currentUser2===void 0?void 0:_auth$currentUser2.uid,selectedFriend]),orderBy(\"timestamp\"));const unsubscribe=onSnapshot(q,snapshot=>{setMessages(snapshot.docs.map(doc=>doc.data()).filter(msg=>{var _auth$currentUser3,_auth$currentUser4;return msg.from===((_auth$currentUser3=auth.currentUser)===null||_auth$currentUser3===void 0?void 0:_auth$currentUser3.uid)&&msg.to===selectedFriend||msg.from===selectedFriend&&msg.to===((_auth$currentUser4=auth.currentUser)===null||_auth$currentUser4===void 0?void 0:_auth$currentUser4.uid);}));});return()=>unsubscribe();},[selectedFriend]);// Scroll to bottom on new message\nuseEffect(()=>{var _messagesEndRef$curre;(_messagesEndRef$curre=messagesEndRef.current)===null||_messagesEndRef$curre===void 0?void 0:_messagesEndRef$curre.scrollIntoView({behavior:\"smooth\"});},[messages]);// Send message\nconst sendMessage=async()=>{var _auth$currentUser5;if(!input.trim()||!selectedFriend)return;await addDoc(collection(db,\"messages\"),{from:(_auth$currentUser5=auth.currentUser)===null||_auth$currentUser5===void 0?void 0:_auth$currentUser5.uid,to:selectedFriend,text:input,timestamp:serverTimestamp()});setInput(\"\");};return/*#__PURE__*/_jsxs(\"div\",{style:{flex:1,overflowY:\"auto\",padding:\"1em\"},children:[/*#__PURE__*/_jsxs(\"div\",{children:[messages.map((msg,idx)=>{var _auth$currentUser6,_auth$currentUser7,_auth$currentUser8,_msg$timestamp;return/*#__PURE__*/_jsxs(\"div\",{style:{textAlign:msg.from===((_auth$currentUser6=auth.currentUser)===null||_auth$currentUser6===void 0?void 0:_auth$currentUser6.uid)?\"right\":\"left\",margin:\"0.5em 0\"},children:[/*#__PURE__*/_jsx(\"span\",{style:{display:\"inline-block\",background:msg.from===((_auth$currentUser7=auth.currentUser)===null||_auth$currentUser7===void 0?void 0:_auth$currentUser7.uid)?\"#4078c0\":\"#eee\",color:msg.from===((_auth$currentUser8=auth.currentUser)===null||_auth$currentUser8===void 0?void 0:_auth$currentUser8.uid)?\"#fff\":\"#222\",borderRadius:\"16px\",padding:\"0.5em 1em\",maxWidth:\"60%\",wordBreak:\"break-word\"},children:msg.text}),/*#__PURE__*/_jsx(\"div\",{style:{fontSize:\"0.8em\",color:\"#888\"},children:(_msg$timestamp=msg.timestamp)!==null&&_msg$timestamp!==void 0&&_msg$timestamp.toDate?msg.timestamp.toDate().toLocaleTimeString():\"\"})]},idx);}),/*#__PURE__*/_jsx(\"div\",{ref:messagesEndRef})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"chat-footer\",children:[/*#__PURE__*/_jsx(\"input\",{className:\"message-input\",placeholder:\"Type a message\",value:input,onChange:e=>setInput(e.target.value),onKeyDown:e=>e.key===\"Enter\"&&sendMessage()}),/*#__PURE__*/_jsx(\"button\",{className:\"send-btn\",onClick:sendMessage,children:\"Send\"})]})]});};export default Chat;","map":{"version":3,"names":["React","useState","useEffect","useRef","auth","db","collection","query","where","orderBy","addDoc","serverTimestamp","onSnapshot","jsx","_jsx","jsxs","_jsxs","Chat","_ref","selectedFriend","messages","setMessages","input","setInput","messagesEndRef","_auth$currentUser","_auth$currentUser2","q","currentUser","uid","unsubscribe","snapshot","docs","map","doc","data","filter","msg","_auth$currentUser3","_auth$currentUser4","from","to","_messagesEndRef$curre","current","scrollIntoView","behavior","sendMessage","_auth$currentUser5","trim","text","timestamp","style","flex","overflowY","padding","children","idx","_auth$currentUser6","_auth$currentUser7","_auth$currentUser8","_msg$timestamp","textAlign","margin","display","background","color","borderRadius","maxWidth","wordBreak","fontSize","toDate","toLocaleTimeString","ref","className","placeholder","value","onChange","e","target","onKeyDown","key","onClick"],"sources":["C:/messagingapp/firebase-react-messaging-app/src/components/Chat.tsx"],"sourcesContent":["import React, { useState, useEffect, useRef } from \"react\";\nimport { auth, db } from \"../firebase/config\";\nimport {\n  collection,\n  query,\n  where,\n  orderBy,\n  getDocs,\n  addDoc,\n  serverTimestamp,\n  onSnapshot,\n} from \"firebase/firestore\";\n\ninterface ChatProps {\n  selectedFriend: string | null;\n}\n\nconst Chat: React.FC<ChatProps> = ({ selectedFriend }) => {\n  const [messages, setMessages] = useState<any[]>([]);\n  const [input, setInput] = useState(\"\");\n  const messagesEndRef = useRef<HTMLDivElement>(null);\n\n  // Fetch messages in real-time\n  useEffect(() => {\n    if (!selectedFriend) {\n      setMessages([]);\n      return;\n    }\n    const q = query(\n      collection(db, \"messages\"),\n      where(\"from\", \"in\", [auth.currentUser?.uid, selectedFriend]),\n      where(\"to\", \"in\", [auth.currentUser?.uid, selectedFriend]),\n      orderBy(\"timestamp\")\n    );\n    const unsubscribe = onSnapshot(q, (snapshot) => {\n      setMessages(\n        snapshot.docs\n          .map((doc) => doc.data())\n          .filter(\n            (msg) =>\n              (msg.from === auth.currentUser?.uid && msg.to === selectedFriend) ||\n              (msg.from === selectedFriend && msg.to === auth.currentUser?.uid)\n          )\n      );\n    });\n    return () => unsubscribe();\n  }, [selectedFriend]);\n\n  // Scroll to bottom on new message\n  useEffect(() => {\n    messagesEndRef.current?.scrollIntoView({ behavior: \"smooth\" });\n  }, [messages]);\n\n  // Send message\n  const sendMessage = async () => {\n    if (!input.trim() || !selectedFriend) return;\n    await addDoc(collection(db, \"messages\"), {\n      from: auth.currentUser?.uid,\n      to: selectedFriend,\n      text: input,\n      timestamp: serverTimestamp(),\n    });\n    setInput(\"\");\n  };\n\n  return (\n    <div style={{ flex: 1, overflowY: \"auto\", padding: \"1em\" }}>\n      <div>\n        {messages.map((msg, idx) => (\n          <div\n            key={idx}\n            style={{\n              textAlign: msg.from === auth.currentUser?.uid ? \"right\" : \"left\",\n              margin: \"0.5em 0\",\n            }}\n          >\n            <span\n              style={{\n                display: \"inline-block\",\n                background: msg.from === auth.currentUser?.uid ? \"#4078c0\" : \"#eee\",\n                color: msg.from === auth.currentUser?.uid ? \"#fff\" : \"#222\",\n                borderRadius: \"16px\",\n                padding: \"0.5em 1em\",\n                maxWidth: \"60%\",\n                wordBreak: \"break-word\",\n              }}\n            >\n              {msg.text}\n            </span>\n            <div style={{ fontSize: \"0.8em\", color: \"#888\" }}>\n              {msg.timestamp?.toDate\n                ? msg.timestamp.toDate().toLocaleTimeString()\n                : \"\"}\n            </div>\n          </div>\n        ))}\n        <div ref={messagesEndRef} />\n      </div>\n      <div className=\"chat-footer\">\n        <input\n          className=\"message-input\"\n          placeholder=\"Type a message\"\n          value={input}\n          onChange={(e) => setInput(e.target.value)}\n          onKeyDown={(e) => e.key === \"Enter\" && sendMessage()}\n        />\n        <button className=\"send-btn\" onClick={sendMessage}>\n          Send\n        </button>\n      </div>\n    </div>\n  );\n};\n\nexport default Chat;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}